name: Main

on:
  push:
    branches:
      - 'main'

# TODO: Release the project and copy current images to docs, commit, set a tag

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: checkout
        uses: actions/checkout@v2
      # ~~~~~~~~~~~~~~~
      # SoC Module
      # ~~~~~~~~~~~~~~~
      - name: KiCad::SoC-Module::Docs
        uses: nerdyscout/kicad-exports@v2.2
        with:
          config: configs/docs.kibot.yaml
          dir: out
          schema: 'soc-module/soc-module.sch'
          board: 'soc-module/soc-module.kicad_pcb'
      - name: KiCad::SoC-Module::Gerber
        uses: nerdyscout/kicad-exports@v2.2
        with:
          config: configs/gerbers.kibot.yaml
          dir: out
          schema: 'soc-module/soc-module.sch'
          board: 'soc-module/soc-module.kicad_pcb'
      - name: KiCad::SoC-Module::Plot
        uses: nerdyscout/kicad-exports@v2.2
        with:
          config: configs/plot.kibot.yaml
          dir: out
          schema: 'soc-module/soc-module.sch'
          board: 'soc-module/soc-module.kicad_pcb'
      - name: KiCad::SoC-Module::Position
        uses: nerdyscout/kicad-exports@v2.2
        with:
          config: configs/position.kibot.yaml
          dir: out
          schema: 'soc-module/soc-module.sch'
          board: 'soc-module/soc-module.kicad_pcb'
      - name: KiCad::SoC-Module::BoM
        uses: nerdyscout/kicad-exports@v2.2
        with:
          config: configs/bom.kibot.yaml
          dir: out
          schema: 'soc-module/soc-module.sch'
          board: 'soc-module/soc-module.kicad_pcb'
      - name: KiCad::SoC-Module::Model
        uses: nerdyscout/kicad-exports@v2.2
        with:
          config: configs/model.kibot.yaml
          dir: out
          schema: 'soc-module/soc-module.sch'
          board: 'soc-module/soc-module.kicad_pcb'
      # ~~~~~~~~~~~~~~~
      # Ethernet Module
      # ~~~~~~~~~~~~~~~
      - name: KiCad::Ethernet-Module::Docs
        uses: nerdyscout/kicad-exports@v2.2
        with:
          config: configs/docs.kibot.yaml
          dir: out
          schema: 'ethernet-extension/ethernet-extension.sch'
          board: 'ethernet-extension/ethernet-extension.kicad_pcb'
      - name: KiCad::Ethernet-Module::Gerber
        uses: nerdyscout/kicad-exports@v2.2
        with:
          config: configs/gerbers.kibot.yaml
          dir: out
          schema: 'ethernet-extension/ethernet-extension.sch'
          board: 'ethernet-extension/ethernet-extension.kicad_pcb'
      - name: KiCad::Ethernet-Module::Plot
        uses: nerdyscout/kicad-exports@v2.2
        with:
          config: configs/plot.kibot.yaml
          dir: out
          schema: 'ethernet-extension/ethernet-extension.sch'
          board: 'ethernet-extension/ethernet-extension.kicad_pcb'
      - name: KiCad::Ethernet-Module::Position
        uses: nerdyscout/kicad-exports@v2.2
        with:
          config: configs/position.kibot.yaml
          dir: out
          schema: 'ethernet-extension/ethernet-extension.sch'
          board: 'ethernet-extension/ethernet-extension.kicad_pcb'
      - name: KiCad::Ethernet-Module::BoM
        uses: nerdyscout/kicad-exports@v2.2
        with:
          config: configs/bom.kibot.yaml
          dir: out
          schema: 'ethernet-extension/ethernet-extension.sch'
          board: 'ethernet-extension/ethernet-extension.kicad_pcb'
      - name: KiCad::Ethernet-Module::Model
        uses: nerdyscout/kicad-exports@v2.2
        with:
          config: configs/model.kibot.yaml
          dir: out
          schema: 'ethernet-extension/ethernet-extension.sch'
          board: 'ethernet-extension/ethernet-extension.kicad_pcb'
      # ~~~~~~~~~~~~~~~
      # Panel Module
      # ~~~~~~~~~~~~~~~
      - name: KiCad::Panel-Module::Docs
        uses: nerdyscout/kicad-exports@v2.2
        with:
          config: configs/docs.kibot.yaml
          dir: out
          schema: 'panel-module/panel-module.sch'
          board: 'panel-module/panel-module.kicad_pcb'
      - name: KiCad::Panel-Module::Gerber
        uses: nerdyscout/kicad-exports@v2.2
        with:
          config: configs/gerbers.kibot.yaml
          dir: out
          schema: 'panel-module/panel-module.sch'
          board: 'panel-module/panel-module.kicad_pcb'
      - name: KiCad::Panel-Module::Plot
        uses: nerdyscout/kicad-exports@v2.2
        with:
          config: configs/plot.kibot.yaml
          dir: out
          schema: 'panel-module/panel-module.sch'
          board: 'panel-module/panel-module.kicad_pcb'
      - name: KiCad::Panel-Module::Position
        uses: nerdyscout/kicad-exports@v2.2
        with:
          config: configs/position.kibot.yaml
          dir: out
          schema: 'panel-module/panel-module.sch'
          board: 'panel-module/panel-module.kicad_pcb'
      - name: KiCad::Panel-Module::BoM
        uses: nerdyscout/kicad-exports@v2.2
        with:
          config: configs/bom.kibot.yaml
          dir: out
          schema: 'panel-module/panel-module.sch'
          board: 'panel-module/panel-module.kicad_pcb'
      - name: KiCad::Panel-Module::Model
        uses: nerdyscout/kicad-exports@v2.2
        with:
          config: configs/model.kibot.yaml
          dir: out
          schema: 'panel-module/panel-module.sch'
          board: 'panel-module/panel-module.kicad_pcb'
      # ~~~~~~~~~~~~~~~
      # Upload
      # ~~~~~~~~~~~~~~~
      - name: upload results
        uses: actions/upload-artifact@v2
        with:
          name: out
          path: out
